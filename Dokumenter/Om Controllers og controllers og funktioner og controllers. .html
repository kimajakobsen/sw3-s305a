<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0130)http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage= -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link rel="stylesheet" type="text/css" href="./Om Controllers og controllers og funktioner og controllers. _files/globalstyle.css"><script language="javascript" type="text/javascript"><!--
var isIE7=(navigator.userAgent.indexOf('MSIE 7')!=-1);window.timestamp='634255089060366101';var P=false;//--></script><script language="javascript" type="text/javascript"><!--
//--></script><script language="javascript" type="text/javascript"><!--
var A={B:'/static/201011\u002D2086\u002Dproquest',C:'16\u002DNOV\u002D2010',D:'9780735645295/writing_a_controller',E:'proquest',F:'B2CC4F4146B5B75E67E630CB0794F680D20CF52D6CB88659FBCD3B3F90809D37D73E2369B88A2B7DD648A7AAFB4E6E2BB018DA78E11448A96F6CF3C89238B852ABBD07654CCBCDC55ACB34C1F365324E757151B96995448C9A429BDA6F0DD835A4F101F2E556908065323D5463B8D56278705982FAFFDD2DEEE4E4637B5AA51778',G:'9c3d7dad\u002D63f7\u002D4734\u002D9698\u002Da775ff3c3ecb',H:'Undefined',I:'6.0.2',J:'MZCPXIXHHVGRSanUZYnJGBOZYWTFIXMTOQFCnINVDSfOJUYTDxLNPYvgYBsU',K:'135',L:'/book',M:'proquest.safaribooksonline.com',N:true,O:0};//--></script><script language="javascript" type="text/javascript" src="./Om Controllers og controllers og funktioner og controllers. _files/custom.js"></script><script type="text/javascript" src="./Om Controllers og controllers og funktioner og controllers. _files/jquery-1.3.2.min.js"></script><script type="text/javascript" src="./Om Controllers og controllers og funktioner og controllers. _files/ferot.js"></script><script type="text/javascript" src="./Om Controllers og controllers og funktioner og controllers. _files/ferot_moblie.js"></script><script type="text/javascript" src="./Om Controllers og controllers og funktioner og controllers. _files/dyncats.js"></script><script type="text/javascript" src="./Om Controllers og controllers og funktioner og controllers. _files/aui6b2b.js"></script><title>Programming Microsoft® ASP.NET MVC &gt; Inside Controllers &gt; Writing a Controller - Pg. : Safari Books Online</title><link rel="canonical" href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/writing_a_controller"><meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7"><meta name="robots" content="index,follow,noarchive"><meta name="description" content="Chapter 4. Inside Controllers - Writing a Controller - "><meta name="keywords" content="9780735645295,Programming Microsoft® ASP.NET MVC,ASP.NET,Controllers,writing,Microsoft Visual Studio,Controller class,Controllers,Controller class,design of,Actions,attributes of,Actions,selector attributes,Controllers,Controller class,design of,Microsoft Visual Studio,Controller class,Mapping,functions to controllers,OrderController,Controllers,Controller class,design of,InvoiceController,Mapping,functions to controllers,SRP (single responsibility principle),Single responsiblity principle (SRP),Methods,Controllers,Controller class,design of,Mapping,functions to controllers,Actions,mapping behavior to,Mapping,functions to controllers,Methods,Input parameters,Architecture,applications,Responsibility-Driven Design (RDD),RDD (Responsibility-Driven Design),Controllers,Controller class,design of,Actions,mapping behavior to,Object stereotypes,Controllers,Controller class,design of,Actions,mapping behavior to,Methods,Mapping,behavior to methods,Controllers,Controller class,design of,Methods,Repository,Repository,Testing,action methods,Mapping,behavior to methods,Controllers,Controller class,design of,Methods,Actions,coordinator vs. controller,Deployment issues,Scalability,Actions,mapping behavior to,Controllers,writing,Controllers,Controller class,design of,Controllers,writing,SuperClass,Signature,Logger property,SuperClass,ILogger,Dependency injection (DI),injection mechanism,Inversion of Control (IoC),dependency injection,Logging,Controller Super class,Injection points,Signature,SuperClass,Exceptions,HandleError,Unknown actions,HandleUnknownAction,Unknown actions,Unknown actions,Dependencies,Unknown actions,Dependencies,ApplicationContext,Initialize method,Controllers,ControllerMoniker,Dependencies,ApplicationContext,ApplicationContext,DefaultControllerFactory,Inversion of Control (IoC),DefaultControllerFactory,Dependencies"><link rel="alternate" type="application/rss+xml" title="RSS" href="http://proquest.safaribooksonline.com/rss"><link rel="stylesheet" type="text/css" href="./Om Controllers og controllers og funktioner og controllers. _files/global.css"><script language="javascript" type="text/javascript" src="./Om Controllers og controllers og funktioner og controllers. _files/urchin.js"></script><script language="javascript" type="text/javascript">var s_account = "safaribooksglobal,safaribooksb2b"; self.linkInternalFilters = "javascript:,proquest.safaribooksonline.com,proquest.safaribooksonline.com,ssl.safaribooksonline.com";</script><script language="javascript" type="text/javascript">
                function s_getDomainName(s)
                {
                    if (!s)
                        return s;
                    if (s.indexOf("http://" == 0))
                        return s.substring(7);
                    if (s.indexOf("https://" == 0))
                        return s.substring(8);
                    return s;
                }
            </script><script language="javascript" type="text/javascript" src="./Om Controllers og controllers og funktioner og controllers. _files/global_book.js"></script></head><body class=" reader"><img name="s_i_safaribooksglobal" height="1" width="1" border="0" alt="" src="./Om Controllers og controllers og funktioner og controllers. _files/s68808899414725"><script language="javascript" type="text/javascript"><!--
 var status = 'Logged'; var currStatus = 'Logged';   var page = '/book';var subpage = 'hometab1'; var productCat = 'Tech'; var uicode = 'aalborg'; var portal = 'proquest'; function customOmnitureHandling(){  s_account='safaribooksglobal';}var grph = {  setBarA: function() {    var numRows = 0;    var divColl = document.getElementsByTagName('div');        for(var i=0; i<divColl.length; i++) {      if(divColl[i].className == 'rowGraphA') {        numRows++;      }    }    for(var i=0; i < numRows; i++) {       var barID = "gA"+(i+1);       var valID = "vA"+(i+1);       var thisParent = document.getElementById(valID).parentNode;       var thisBar = document.getElementById(barID);       var thisVal = document.getElementById(valID).innerHTML;              if( (i % 2) == 0) {          thisParent.className = 'rowGraphA evenRowGraph';       }       thisVal = thisVal.replace(/\(/, "");       thisVal = thisVal.replace(/\)/, "");       thisVal = thisVal.replace(/\%/, "");       thisVal = ((thisVal/100)*420);       thisBar.style.width = thisVal+'%';    }  },  setBarB: function() {    var numRows = 0;    var divColl = document.getElementsByTagName('div');        for(var i=0; i<divColl.length; i++) {      if(divColl[i].className == 'rowGraphB') {        numRows++;      }    }    for(var i=0; i < numRows; i++) {       var barID = "gB"+(i+1);       var valID = "vB"+(i+1);       var thisParent = document.getElementById(valID).parentNode;       var thisBar = document.getElementById(barID);       var thisVal = document.getElementById(valID).innerHTML;              if( (i % 2) == 0) {          thisParent.className = 'rowGraphB evenRowGraph';       }       thisVal = thisVal.replace(/\(/, "");       thisVal = thisVal.replace(/\)/, "");       thisVal = thisVal.replace(/\%/, "");       thisVal = ((thisVal/100)*420);       thisBar.style.width = thisVal+'%';    }  }};function customOnPageLoad() {  if (page == "/home") {   aui.dynInitCalls();   }    if(page == '/statistics') {     grph.setBarA();    grph.setBarB();  }      if(page == '/508compliance') {      var h2coll = document.getElementsByTagName('h2');    h2coll[0].innerHTML = "Accessibility";  }    /* Automatic Tip of the Week Pop Up */  /* cookies:             userTow = the user preference check box in the popup             sessionTow = a (browser) session cookie to track whether or not to pop up the                           tow upon page load (unless the user has 'opted out', we only want to do so                           on the initial login, not ever time the user navigates to a new page)                            */      var s=s_gi(s_account);s.linkTrackVars='prop10,eVar10';  if(currStatus == 'Logged' && (portal == 'search' || portal=='techbus') && page != '/workgroup' ) {        if(!tow.readCookie('sessionTow') || tow.readCookie('sessionTow') == 'false') {            if(tow.readCookie('userTow')) {                      if(tow.readCookie('userTow') == 'true') {          OpenGenericPopup(this, 600, true, 'myvariable1=autotip&myvariable2=true');        } else {                   }            } else {                        OpenGenericPopup(this, 600, true, 'myvariable1=autotip&myvariable2=true');      }            tow.createCookie('sessionTow','true');    } else {              }  } else {       tow.createCookie('sessionTow','false');  }  }  if( (page == '/home') && (currStatus == 'Logged')) {        ferot.addEvent(window, 'load', ferot.initFeatureBucket);}  if (page == '/mobile') {        ferotM.addEvent(window, 'load', ferotM.initFeatureBucket);}  //--></script><script language="javascript" type="text/javascript"><!--
window.ajaxIsReady=function(Q){if(!window.ajaxInitializationStarted)return false;if(ready){if(Q){if(!ready[Q])return false;}else {for(var R in ready)if(!ready[R])return false;}}return true;};window.pageIsLoaded=function(){if(window.pageLoadingFinished)return true;return false;};//--></script><script language="javascript" type="text/javascript"><!--

var google_analytics;

window.ga_getDomainName = function(s)
{
 if (!s) return s;
 if (s.indexOf("http://" == 0))
  return s.substring(7);
 if (s.indexOf("https://" == 0))
  return s.substring(8);
 return s;
}

window.logHit=function(className, state, isAjax)
{
    if (!className)
        className = '/book';
    else
        className = '/' + className;

    _uacct = '';
    
    var referrer = 'Undefined';
    
    if(_uacct != '')
    {
        try
        {
            var SKU = "B2B-LB-ALL-A";
            __utmSetVar(SKU);
            var toTrack = className;
            if (window.urchinStep)
                toTrack += '/' + window.urchinStep;
            urchinTracker(toTrack); 
            google_analytics = toTrack;
            var hasTrans = false;
            if (hasTrans || window.globalHasTrans)
            {
                __utmSetTrans();
                window.globalHasTrans = false;
            }
        }
        catch(e)
        {
        }
    }
    if (!isAjax && true) {
         if (self.s) { s.pageName='Book';s.channel='ProQuest Tech Books';s.server='fe80::b806:f3eb:1be7:1127%11';s.prop1='';s.prop2='B2B';s.prop3='46253';s.prop4='2214932';s.prop5='499017';s.prop6='Aalborg University';s.prop7='ProQuest';s.prop8='5';s.prop11='O\u0027Reilly Media, Inc.';s.prop12='Microsoft Press';s.prop13='Microsoft Press';s.prop14='Programming Microsoft® ASP.NET MVC: 9780735645295/writing_a_controller';s.prop15='Writing a Controller';s.prop16='0';s.prop36='YES';s.prop37='';s.prop9='LB\u002DALL\u002DA';s.prop38='XHTML';s.prop44='BookPage';s.prop46='Book';s.prop47='LoggedIn';s.prop48='PreviewFromBrowse';s.products=';LB\u002DALL\u002DA';s.prop50='Library';s.prop45='Start Reading';s_account='safaribooksglobal,safaribooksb2b';s.events='event1';s.eVar1 = s.prop1; s.eVar2 = s.prop2; s.eVar3 = s.prop3; s.eVar4 = s.prop4; s.eVar5 = s.prop5; s.eVar6 = s.prop6; s.eVar7 = s.prop7; s.eVar8 = s.prop8; s.eVar9 = s.prop9; s.eVar11 = s.prop11; s.eVar12 = s.prop12; s.eVar13 = s.prop13; s.eVar14 = s.prop14; s.eVar15 = s.prop15; s.eVar16 = s.prop16; s.eVar36 = s.prop36; s.eVar37 = s.prop37; s.eVar38 = s.prop38; s.eVar45 = s.prop45; s.eVar47 = s.prop47; s.eVar48 = s.prop48; s.eVar50 = s.prop50; if (self.customOmnitureHandling) self.customOmnitureHandling(); var s_code=s.t(); if(s_code)document.write(s_code);}
    }
}
//--></script><script language="javascript" type="text/javascript"><!--
if(self.S)self.S('State','aph=MZCPXIXHHVGRSanUZYnJGBOZYWTFIXMTOQFCnINVDSfOJUYTDxLNPYvgYBsU&uicode=aalborg&PromoCode=&reader=html&displaygrbooks=0&isbn=9780735645295&xmlid=9780735645295%2fwriting_a_controller&itemsperpage=50&query=(SQL%2fXML)&action=4&HttpReferrer=http%3a%2f%2fproquest.safaribooksonline.com%2f9780735645295%2fwriting_a_controller%3freaderfullscreen%3d%26readerleftmenu%3d1%26reader%3d&imagepage=&portal=proquest&omniturexmlidown=1');//--></script><div id="loading" style="position: absolute; z-index: 100; top: 315px; left: 526px; display: none; "><img id="loadingImg" src="./Om Controllers og controllers og funktioner og controllers. _files/loading.gif" alt=""></div><div><a class="skiplink" href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#lefttabtoc">Table of Contents</a><div id="bvdtop100"></div><div class="pagewrap_reader" id="pagewrapid"><div id="pagetopid"><div><div class="logo"><a href="http://proquest.safaribooksonline.com/"><img class="sitelogo" src="./Om Controllers og controllers og funktioner og controllers. _files/logo_sbo.gif" alt="Safari Books Online" title="Safari Books Online"></a><div class="b2bpartnerlogo"><img src="./Om Controllers og controllers og funktioner og controllers. _files/logo_pq.gif" alt="ProQuest"></div><span class="clearfloats"></span></div><div class="global_nav_container"><ul class="global_navL"><li class="gnavL" id="homenav"><a class="navbtn" href="http://proquest.safaribooksonline.com/">Home</a></li></ul><ul class="global_navR"><li class="gnavR" id="catbrowsenav"><a id="catbrowseLink" href="http://proquest.safaribooksonline.com/categories" class="btnpos1">Category Browser</a></li><li class="sgl_spacer"></li><li class="gnavR" id="quicklinksnav"><a id="quicklinksLink" href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" class="btnpos1" onclick="ToggleQuickLinks(); return false;">My Quick Links</a><div class="globalnav_dd_boxQL" id="qldd" style="left: -999em;"><div class="globalnav_dd_box_int1"><div class="globalnav_dd_box_intQL"><div class="bluBrdrBox1"><span class="blubr1ct"><span class="blubr1cl"></span></span><div class="blubrBoxContent"><ul class="global_nav_dd" id="quicklinks_dd1"><li><a href="http://proquest.safaribooksonline.com/books">Books</a></li><li><a href="http://proquest.safaribooksonline.com/shortcuts">Short Cuts</a></li></ul><span class="clearfloats"></span></div><span class="blubr1bl"><span class="blubr1br"></span></span></div></div></div></div></li></ul></div></div><div class="global_search_container"><div class="global_searchL"><form action="http://proquest.safaribooksonline.com/search" method="post" onsubmit="SearchOnSubmit(&#39;[Start a New Search]&#39;);" id="topsearchform"><label class="hidelabel" for="searchtextbox" accesskey="0"><span>Search:</span></label><input id="searchtextbox" class="global_search_formElem" type="text" onfocus="SearchClearTextbox(this, &#39;[Start a New Search]&#39;);" value="[Start a New Search]" name="searchtextbox" size="30" autocomplete="off"><label class="hidelabel" for="searchlistbox"><span>criteria:</span></label><select id="searchlistbox" class="global_search_formElem" name="searchlistbox"><option value="">Entire Site</option><option value="BOOKTITLE">Book Titles</option></select><input id="searchsubmit" class="global_search_formBtn" type="image" name="__searchsubmit" alt="Search" src="./Om Controllers og controllers og funktioner og controllers. _files/btn_global_search_go.gif" value="Search"><input id="searchmode" type="hidden" name="searchmode" value="newsimple"></form><a title="Advanced Search" onclick="return OpenAdvancedSearchPopup(this)" href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#"><img id="advoptsbtn" class="global_search_formElem" src="./Om Controllers og controllers og funktioner og controllers. _files/btn_global_search_adv.gif" title="Advanced Search" alt="Advanced Search"></a></div><div class="global_searchR"><div class="p gs_textline"><a href="http://proquest.safaribooksonline.com/logout?targetpage=/home" title="Sign Out">Sign Out &amp; Clear Session</a>
    •&nbsp;
                  <a href="http://proquest.safaribooksonline.com/logout?targetpage=/securelogin" title="Personal Sign In">Personal Sign In
                  </a></div></div></div><script language="javascript" type="text/javascript"><!--
function Z(){var a=15;    mask = "8";    mask |= "6";    mask |= "1";    var b={'controlid':'searchtextbox','dropdownid':'ssdd','showsuggest':true,'url':'/suggest?count=10&mask='+a+'&query=','cssclass':'global_nav_dd bg_wt','ondropdownclick':function(){T.c("topsearchform").submit();}};var d=new AjaxDropDown('topdropdown',b);}T.U.V(Z);//--></script></div><div class="reader_container " id="readercontainer"><div class="paneL" id="readerleft" style="height: 12344px; "><div class="paneL_cap" id="leftbookinfotop"><h5 class="h5"><a href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295" title="This Book">This Book</a></h5></div><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'leftbookinfopanel','Url':'/_ajax_leftbookinfopanel_1_449930','MergeName':'leftbookinfopanel','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':null,'IsXml':false,'StaticOnLoad':true,'DisableAjaxHistory':true,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=bookinfopanel'),'DynamicParameters':new Array()});//--></script><div id="leftbookinfopanel" style="display: block; "><div class="paneContent"><a href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295" title="Programming Microsoft® ASP.NET MVC"><img class="meta_image" alt="Programming Microsoft® ASP.NET MVC" title="Programming Microsoft® ASP.NET MVC" width="76" src="./Om Controllers og controllers og funktioner og controllers. _files/9780735645295_xs.jpg"></a><p class="p meta_title"><a href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295" title="Programming Microsoft® ASP.NET MVC">Programming Microsoft® ASP.NET MVC</a></p><span class="clearfloats"></span></div></div><div class="bucket_cap" id="bucketsearch"><h5 class="h5 closed" id="leftbtnsearch"><a href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/writing_a_controller?bookview=search" onclick="return W.CC.CJ(&#39;tabsearch&#39;);" title="Search">Search</a></h5></div><div class="nodisplay" id="lefttabsearch"><div class="search_constant" id="leftsearchform"><form method="post" action="http://proquest.safaribooksonline.com/searchbook" id="form_454859" onsubmit="W.CC.CJ(&#39;tabsearch&#39;,true);T.p.q(this,&#39;&#39;,&#39;SearchTable&#39;);return false;"><input type="hidden" name="__formName" value="454859"><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'leftsearchparameters','Url':'/_ajax_flashreader','MergeName':'FlashReader','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':null,'IsXml':false,'StaticOnLoad':true,'DisableAjaxHistory':false,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=flashreader','reader=html','__isrc='),'DynamicParameters':new Array('xmlid=9780735645295%2fwriting_a_controller','imagepage=')});//--></script><div id="leftsearchparameters" style="display: block; "><div style="display:none;"><input value="9780735645295/inside_controllers" type="hidden" name="__parentsection" id="parentsection"><input value="9780735645295/writing_a_controller" type="hidden" name="__xmlid" id="xmlid"></div></div><label class="hide_label" for="booksearchfor"><span>search in</span></label><select id="booksearchfor" name="__booksearchfor"><option value="">This Book</option><option value="chapter">This Chapter</option></select><br><label class="hide_label" for="query"><span>search for</span></label><input id="query" type="text" name="query" value="(SQL/XML)"><input type="text" style="visibility:hidden;display:none;"><input class="sbmt_go" id="searchreadersubmit" value="Go" src="./Om Controllers og controllers og funktioner og controllers. _files/btn_search_go.gif" alt="Go" type="image" name="__searchreadersubmit" title="Go"></form><span class="clearfloats"></span></div><div><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'searchresulttop','Url':'/_ajax_searchtable_1_513366','MergeName':'SearchTable','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':null,'IsXml':false,'StaticOnLoad':false,'DisableAjaxHistory':true,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=SearchBook','__bookisbn=9780735645295','__isreader=1','sort=rank','order=desc','page=0'),'DynamicParameters':new Array()});//--></script><div id="searchresulttop"><div><div><input value="(SQL/XML)" type="hidden" name="" id="viewerquery"><p class="p search_counter"><span>No Results for "</span><strong class="strong">(SQL/XML)</strong><span>"</span></p></div></div></div><div class="paneContent_search" style="overflow: auto; " id="searchresulttable"><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'searchlist','Url':'/_ajax_searchtable_1_513366','MergeName':'SearchTable','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':'W.CC.CX ','IsXml':false,'StaticOnLoad':false,'DisableAjaxHistory':true,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=SearchBook','__bookisbn=9780735645295','__isreader=1','sort=rank','order=desc','page=0'),'DynamicParameters':new Array()});//--></script><div id="searchlist" style="display: none; "></div></div><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'searchresultbottom','Url':'/_ajax_searchtable_1_513366','MergeName':'SearchTable','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':null,'IsXml':false,'StaticOnLoad':false,'DisableAjaxHistory':true,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=SearchBook','__bookisbn=9780735645295','__isreader=1','sort=rank','order=desc','page=0'),'DynamicParameters':new Array()});//--></script><div id="searchresultbottom" style="display: none; "></div></div></div><div class="bucket_cap" id="buckettoc"><h5 class="h5 open" id="leftbtntoc"><a href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/writing_a_controller?bookview=contents" onclick="return W.CC.CJ(&#39;tabtoc&#39;);" title="Contents">Contents</a></h5></div><div class="paneContent " id="lefttabtoc" style="max-height: 12165px; "><ul class="toc"><li class="pre_chap"><a href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295" title="Table of Contents">Table of Contents</a></li><li class="pre_chap"><a href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/index/index" onclick="return W.CC.Cg(&#39;9780735645295/index&#39;);" title="Index">Index</a></li><li class="spacer"></li></ul><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'lefttoc','Url':'/_ajax_flashreader','MergeName':'FlashReader','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':'W.CC.Ck ','IsXml':false,'StaticOnLoad':true,'DisableAjaxHistory':false,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=flashreader','reader=html','__isrc='),'DynamicParameters':new Array('xmlid=9780735645295%2fwriting_a_controller','imagepage=')});//--></script><div id="lefttoc" style="display: block; "><div><input value="9780735645295/writing_a_controller" type="hidden" name="" id="toccurrentxmlid"><div class="toc"><div class="tocitem "><a class=" " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/copyright/kurt2safari_copyright_id" onclick="return W.CC.Cg(&#39;9780735645295/kurt2safari_copyright_id&#39;);" title="Copyright">Copyright</a></div><div class="tocitem "><a class=" " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/dedication/dedication" onclick="return W.CC.Cg(&#39;9780735645295/dedication&#39;);" title="Dedication">Dedication</a></div><div class="tocitem "><a class=" " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/acknowledgments/acknowledgments" onclick="return W.CC.Cg(&#39;9780735645295/acknowledgments&#39;);" title="Acknowledgments">Acknowledgments</a></div><div class="tocitem "><a class=" " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/introduction/introduction" onclick="return W.CC.Cg(&#39;9780735645295/introduction&#39;);" title="Introduction">Introduction</a></div><div class="tocitem "><a class="closed " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/the-programming-paradigm/the_programming_paradigm" onclick="return W.CC.Cg(&#39;9780735645295/the_programming_paradigm&#39;);" title="Pt. I. The Programming Paradigm">Pt. I.&nbsp;The Programming Paradigm</a></div><div class="tocitem "><a class="open " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/the-core-of-aspdotnet-mvc/the_core_of_asp_net_mvc" onclick="return W.CC.Cg(&#39;9780735645295/the_core_of_asp_net_mvc&#39;);" title="Pt. II. The Core of ASP.NET MVC">Pt. II.&nbsp;The Core of ASP.NET MVC</a></div><div class="tocitem level1"><a class="open " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/the-core-of-aspdotnet-mvc/inside_controllers" onclick="return W.CC.Cg(&#39;9780735645295/inside_controllers&#39;);" title="Ch. 4. Inside Controllers">Ch. 4.&nbsp;Inside Controllers</a></div><div class="tocitem level2"><a class=" " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/the_role_of_controllers_and_the_motivati" onclick="return W.CC.Cg(&#39;9780735645295/the_role_of_controllers_and_the_motivati&#39;);" title="The Role of Controllers and the Motivation for Using Them">The Role of Controllers and the Motivation for Using Them</a></div><div class="tocitem level2"><a class=" " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/anatomy_of_an_aspnet_mvc_controller" onclick="return W.CC.Cg(&#39;9780735645295/anatomy_of_an_aspnet_mvc_controller&#39;);" title="Anatomy of an ASP.NET MVC Controller">Anatomy of an ASP.NET MVC Controller</a></div><div class="tocitem level2"><a class=" current" href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/writing_a_controller" onclick="return W.CC.Cg(&#39;9780735645295/writing_a_controller&#39;);" title="Writing a Controller">Writing a Controller</a></div><div class="tocitem level2"><a class=" " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/special_capabilities" onclick="return W.CC.Cg(&#39;9780735645295/special_capabilities&#39;);" title="Special Capabilities">Special Capabilities</a></div><div class="tocitem level2"><a class=" " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/controllers_and_testability" onclick="return W.CC.Cg(&#39;9780735645295/controllers_and_testability&#39;);" title="Controllers and Testability">Controllers and Testability</a></div><div class="tocitem level2"><a class=" " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/summary-id003" onclick="return W.CC.Cg(&#39;9780735645295/summary-id003&#39;);" title="Summary">Summary</a></div><div class="tocitem level1"><a class="closed " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/the-core-of-aspdotnet-mvc/inside_views" onclick="return W.CC.Cg(&#39;9780735645295/inside_views&#39;);" title="Ch. 5. Inside Views">Ch. 5.&nbsp;Inside Views</a></div><div class="tocitem level1"><a class="closed " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/the-core-of-aspdotnet-mvc/inside_models" onclick="return W.CC.Cg(&#39;9780735645295/inside_models&#39;);" title="Ch. 6. Inside Models">Ch. 6.&nbsp;Inside Models</a></div><div class="tocitem "><a class="closed " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/programming-features/programming_features" onclick="return W.CC.Cg(&#39;9780735645295/programming_features&#39;);" title="Pt. III. Programming Features">Pt. III.&nbsp;Programming Features</a></div><div class="tocitem "><a class="closed " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/resharper-and-the-power-of-tools/resharper_and_the_power_of_tools" onclick="return W.CC.Cg(&#39;9780735645295/resharper_and_the_power_of_tools&#39;);" title="Appx. A. ReSharper and the Power of Tools">Appx. A.&nbsp;ReSharper and the Power of Tools</a></div><div class="tocitem "><a class=" " href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/index/index" onclick="return W.CC.Cg(&#39;9780735645295/index&#39;);" title="Index">Index</a></div></div></div></div></div><div id="readerleft_spacer"></div></div><div class="paneR" id="readerright"><div class="colHideTab" id="leftmenubtn" onclick="W.CC.Cl();return false;"></div><div id="readermarketing"><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'flashreadermarketing','Url':'/_ajax_flashreader','MergeName':'FlashReader','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':null,'IsXml':false,'StaticOnLoad':true,'DisableAjaxHistory':false,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=flashreader','reader=html'),'DynamicParameters':new Array('xmlid=9780735645295%2fwriting_a_controller','imagepage=')});//--></script><div id="flashreadermarketing" style="display: block; "><div></div></div></div><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'ReturnToSearch','Url':'/_ajax_returntosearch_1_474021','MergeName':'ReturnToSearch','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':null,'IsXml':false,'StaticOnLoad':true,'DisableAjaxHistory':true,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array(),'DynamicParameters':new Array()});//--></script><div id="ReturnToSearch" style="display: block; "></div><div class="toolbar" id="readertoolbar"><span class="rightcap"></span><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'topbuttons','Url':'/_ajax_flashreader','MergeName':'FlashReader','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':null,'IsXml':false,'StaticOnLoad':true,'DisableAjaxHistory':false,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=flashreader','reader=html','__isrc='),'DynamicParameters':new Array('xmlid=9780735645295%2fwriting_a_controller','imagepage=')});//--></script><div id="topbuttons" style="display: block; "><div class="fltlft"><ul class="toolbar_btn_list"><li id="toolbar_logo"><img alt="Safari Books Online" title="Safari Books Online" src="./Om Controllers og controllers og funktioner og controllers. _files/logo_toolbar_full.gif"></li><li class="w24"><a class="remail" id="email" href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="return W.f.Co(this,&#39;http://proquest.safaribooksonline.com/9780735645295/writing_a_controller&#39;);" title="Email This Page (Key: e)">Email This Page (Key: e)</a><span class="emailDisabled">Email This Page</span></li><li class="w24"><a class="print" id="print" href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="Cc.Cp();return false;" title="Print">Print</a><span class="printDisabled">Print</span></li></ul></div></div><div class="fltrght"><ul class="toolbar_btn_list"><li class="w68"><a class="html active" id="html" href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/writing_a_controller?reader=" title="Html View (Key: h)">Html View (Key: h)</a></li><li class="w27a" id="zoomOutBtns"><a class="fontdn" id="fontdn" href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="Cc.Cr();return false;" title="Zoom Out (Key: -)">Zoom Out (Key: -)</a><span class="fontdnDisabled">Zoom Out</span></li><li class="w27" id="zoomInBtns"><a class="fontup" id="fontup" href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="Cc.Cs();return false;" title="Zoom In (Key: +)">Zoom In (Key: +)</a><span class="fontupDisabled">Zoom In</span></li><li class="screen"><a class="fullscreen " id="fullscreenbtn" href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="W.CC.Cv();return false;" title="Toggle to Full Screen (Key: f)">Toggle to Full Screen (Key: f)</a></li><li class="w24 " id="prevBtns"><a class="prev" id="prev" href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/anatomy_of_an_aspnet_mvc_controller" accesskey="1" onclick="W.CC.Cw();return false;" title="Previous (Key: p)">Previous (Key: p)</a><span class="prevDisabled">Previous</span></li><li class="w24 " id="nextBtns"><a class="next" id="next" href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/special_capabilities" accesskey="3" onclick="W.CC.Cx();return false;" title="Next (Key: n)">Next (Key: n)</a><span class="nextDisabled">Next</span></li></ul></div></div><div class="locationbar "><div class="fltrght"><span> </span><a href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="return W.f.C0(Cc.Cz(),this);" title="URL"><img class="urlbtn" alt="URL" title="URL" src="./Om Controllers og controllers og funktioner og controllers. _files/btn_reader_url.gif"></a><span> </span><form action="./Om Controllers og controllers og funktioner og controllers. _files/Om Controllers og controllers og funktioner og controllers. .html" id="form_474730"><input type="hidden" name="__formName" value="474730"><input id="showterms" type="checkbox" name="__showterms" checked="checked" value="true" onchange="var r=document.getElementById(&#39;showterms_hidden&#39;);if(r)r.disabled=checked;W.CC.C1(this);" onclick="var r=document.getElementById(&#39;showterms_hidden&#39;);if(r)r.disabled=checked;W.CC.C1(this);"><input type="hidden" name="__showterms" id="showterms_hidden" value="" disabled="disabled"><span> </span><label for="showterms"><span><img class="showterms" alt="Show search terms" title="Show search terms" src="./Om Controllers og controllers og funktioner og controllers. _files/txt_showterms.gif"></span></label></form><a href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="return W.f.g(&#39;readerbook&#39;,this);" title="Help"><img class="help" alt="Help" title="Help" src="./Om Controllers og controllers og funktioner og controllers. _files/btn_help.gif"></a></div><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'readerlocation','Url':'/_ajax_flashreader','MergeName':'FlashReader','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':null,'IsXml':false,'StaticOnLoad':true,'DisableAjaxHistory':false,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=flashreader','reader=html'),'DynamicParameters':new Array('xmlid=9780735645295%2fwriting_a_controller','imagepage=')});//--></script><div id="readerlocation" style="display: block; "><div class="fltlft"><h1 class="h1 breadcrumb"><a href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/the-core-of-aspdotnet-mvc/inside_controllers" onclick="return W.CC.Cg(&#39;9780735645295/inside_controllers&#39;);" title="Chapter 4. Inside Controllers"><span>Chapter 4.&nbsp;Inside Controllers</span></a><span>&nbsp;&gt;&nbsp;</span><span>Writing a Controller</span></h1></div></div><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'readerlocationrc','Url':'/_ajax_flashreader','MergeName':'FlashReader','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':null,'IsXml':false,'StaticOnLoad':true,'DisableAjaxHistory':false,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=flashreader','reader=html','__isrc='),'DynamicParameters':new Array('xmlid=9780735645295%2fwriting_a_controller','imagepage=')});//--></script><div id="readerlocationrc" style="display: block; "></div></div><div class="readerContent htmlreadercontent showhighlights" id="readercontent" style="font-size: 120%; min-height: 400px; "><a class="navigations" id="navbarleft" href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/anatomy_of_an_aspnet_mvc_controller" onclick="W.CC.Cw();return false;" title="Previous"><div class="navtop_left"></div><div class="navcenter_left"></div><div class="navbottom_left"></div></a><a class="navigations navigationsRight" id="navbarright" href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/special_capabilities" onclick="W.CC.Cx();return false;" title="Next"><div class="navtop_right"></div><div class="navcenter_right"></div><div class="navbottom_right"></div></a><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'htmltopbuttons','Url':'/_ajax_flashreader','MergeName':'FlashReader','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':null,'IsXml':false,'StaticOnLoad':true,'DisableAjaxHistory':false,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=flashreader','reader=html','__isrc='),'DynamicParameters':new Array('xmlid=9780735645295%2fwriting_a_controller','imagepage=')});//--></script><div id="htmltopbuttons" style="display: block; "></div><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'HtmlView','Url':'/_ajax_htmlview','MergeName':'HtmlView','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':'ViewerHtmlOnAjaxUpdated ','IsXml':false,'StaticOnLoad':false,'DisableAjaxHistory':true,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=bookhtmlcontent','reader=html','xmlid=9780735645295/writing_a_controller'),'DynamicParameters':new Array()});//--></script><div id="HtmlView"><div><div class="htmlcontent"><a name="writing_a_controller"></a>
<h3 class="docSection1Title" id="-100000">4.3. <a name="snippet"></a>Writing a Controller</h3>
<p class="docText"><a name="Even though"></a>Even though <span class="docEmphasis">IController</span> and <span class="docEmphasis">ControllerBase</span><a name="recommended that"></a> are defined and publicly documented, it's not recommended that you build your controllers from the ground up. Inheriting from <span class="docEmphasis">Controller</span><a name="programming power"></a> saves you a lot of preparatory work without limiting your programming power.<a name="idx-CHP-4-1076"></a></p>
<p class="docText">The writing of a <a name="idx-CHP-4-1077"></a><a name="class that"></a>controller class can be summarized in two simple steps: creating a class that derives from <span class="docEmphasis">Controller</span><a name="adding a"></a> and adding a bunch of public methods.</p>
<p class="docText"><a name="of the"></a>The definition of the range of methods that belong to a particular controller, instead, is a very delicate art and deserves a bit of preliminary analysis. Another point that deserves some attention is to decide whether or not you actually need to create your own application-specific base controller class.</p>
<a name="design_of_a_controller_class"></a>
<h4 id="title-ID0ERHBG" class="docSection2Title">4.3.1. Design of a Controller Class</h4>
<p class="docText"><a name="own application"></a>Visual Studio makes it easy to create your own application-specific base controller class. It tells you to right-click on the Controllers folder in the open ASP.NET MVC project and choose to add a new controller class, as shown in <a class="docLink" href="javascript:moveTo('adding_scaffolding_for_a_new_controller_');">Figure 4-9</a>.<a name="idx-CHP-4-1078"></a><a name="I_indexterm1_id2908623"></a><a name="I_indexterm1_id2908634"></a></p>
<p class="docText"><a name="create a"></a>Visual Studio also offers to create a bunch of action methods for you that address common CRUD scenarios. Is that really all that you need?</p>
<a name="adding_scaffolding_for_a_new_controller_"></a><p></p><center>
<h5 class="docFigureTitle">Figure 4-9. Adding scaffolding for a new controller in Visual Studio</h5>
<a name="I_mediaobject1_id2908660"></a>

<p class="docText">
<img border="0" id="" src="./Om Controllers og controllers og funktioner og controllers. _files/getfile" alt="">
</p>

</center><p></p><br>
<p class="docText"><a name="MVC and"></a>Honestly, the Visual Studio facilities are good at making sense of ASP.NET MVC and its controller objects, but they're of little help when it comes to <a name="idx-CHP-4-1079"></a><a name="designing a"></a>designing a real-world application.</p>
<p class="docText">You devise your <a name="idx-CHP-4-1080"></a><a name="granularity and"></a>controller classes based on two factors: granularity and responsibilities. The final set of controller classes should effectively meet the needs of the presentation layer, be easy to test, be easy to maintain and evolve, and map nicely to any URL scheme you might have in mind for the application.</p>
<a name="mapping_functions_to_controllers"></a>
<h5 id="title-ID0EZJBG" class="docSection3Title">4.3.1.1. Mapping Functions to Controllers</h5>
<p class="docText"><a name="a user"></a>In an ASP.NET MVC application, controllers exist to respond to any requests a user makes from within the user interface. Any possible interaction between the user and the application is typically described by a use-case. As an architect, you start from use-cases to form a clear idea of the functions that a user should be able to perform through the application.<a name="idx-CHP-4-1081"></a></p>
<p class="docText">Your next task will <span class="docEmphasis">simply</span> be mapping functions to controller classes.</p>
<p class="docText"><a name="of controller"></a>There are no fixed rules as far as the granularity of controller classes is concerned. No technical reasons prevent you from having a single all-encompassing controller class; likewise, there are no technical hurdles blocking you from having one controller class for each possible request.</p>
<p class="docText"><a name="at the"></a>You're now at the point of partitioning off the set of functions in a <span class="docEmphasis">balanced</span><a name="controller classes"></a> number of controller classes. How you do that depends on the functions and, more importantly, on the <span class="docEmphasis">vision</span><a name="rule of"></a> of the application that emerges from use-cases. As a rule of thumb, you should endeavor to have one controller class for each significant entity in the domain of the problem your application is called to solve.</p>
<p class="docText"><a name="you face"></a>In a commercial site, it's likely that you face use-cases that require CRUD operations on customers, orders, and invoices. You can then start with an <span class="docEmphasis">OrderController</span><a name="update or"></a> to let customers create a new order as well as update or delete existing orders. In doing so, you must stay focused on the needs of the presentation layer and put aside, as momentarily irrelevant, the needs of the entity model for the business layer.<a name="idx-CHP-4-1082"></a></p>
<p class="docText"><a name="If you"></a>If you deal with orders, you likely need to deal with order details and products. However, although <span class="docEmphasis">Order, OrderDetail</span>, and <span class="docEmphasis">Product</span><a name="become a"></a> are all good candidates to become a member of the entity model (or domain model if you apply the domain-driven <a name="idx-CHP-4-1083"></a>design methodology), only <span class="docEmphasis">Order</span><a name="in fact"></a> makes sense as the inspirer of a controller class. From the user-interface perspective, in fact, a user will place commands only to create, update, or delete an order. If that's the case, it's then OK to have an <span class="docEmphasis">OrderController</span>, but it's not OK to have an <span class="docEmphasis">OrderDetailController</span>. A quick rule is the following:</p>
<p class="docText"><a name="exposed to"></a>Have a controller for each business entity that is directly exposed to the presentation layer.</p>
<p class="docText"><a name="might be"></a>This might be only the first pass, though.</p>
<p class="docText"><a name="one of"></a>Suppose that one of the use-cases require you to let users view invoices. An <span class="docEmphasis">InvoiceController</span><a name="the users"></a> class will then be in order to serve the users' needs. In a commercial site, though, you'll likely provide a back-office section for administrative work, such as processing orders and invoices. In this case, it might be useful to have a distinct controller to support back-office operations on orders and invoices. Another quick rule is the following:<a name="idx-CHP-4-1084"></a></p>
<p class="docText"><span class="docEmphasis"><a name="business entity"></a>Have a controller for each business entity</span> that is directly exposed to the presentation layer <span class="docEmphasis">and for each operational context</span>.</p>
<p class="docText">In the end, the mapping of <a name="idx-CHP-4-1085"></a><a name="certainly not"></a>functions to controllers, and the subsequent mapping of methods to controllers, is certainly not an exact science. However, with the correct and systematic application of a key design principle, you can really achieve a design that's acceptable to all stakeholders in the project. The principle is the <span class="docEmphasis"><a name="Single Responsibility"></a>Single Responsibility Principle</span><a name="earlier descend"></a> (SRP). The two quick rules outlined earlier descend from SRP as applied to controllers in an MVC scenario.</p>
<a name="the_single_responsibility_principle"></a><p></p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tbody><tr><td>
<h2 class="docSidebarTitle">The Single Responsibility Principle</h2>
<p class="docText">The essence of <a name="idx-CHP-4-1086"></a><a name="even a"></a>SRP is that any software module—whether a class, a service, a component or even a procedure—should have just one reason to change. What, then, is a "reason to change"?<a name="idx-CHP-4-1087"></a></p>
<p class="docText">A class that focuses on doing just <span class="docEmphasis">one thing</span><a name="single feature"></a> needs to be changed only if requirements change for that single feature. Hence, a class that focuses on doing just <span class="docEmphasis">one thing</span><a name="just one"></a> has just one reason to change.</p>
<p class="docText"><a name="stresses the"></a>The principle stresses the need to have highly cohesive classes that expose a set of strongly and logically related <a name="idx-CHP-4-1088"></a><a name="just one"></a>methods. All methods in a class contribute to serve just one purpose—the single responsibility of the class. SRP is about cohesion, and in software, cohesion measures the distance between the logic expressed by the various methods of a class. To get a better grasp of software cohesion, think for a moment about what cohesion means in another field—chemistry. In chemistry, cohesion is a physical property of a substance that indicates the attraction existing between like molecules within a body. Methods in the body of a class should be similar to like molecules in the body of a substance.</p>
<p class="docText"><a name="classes with"></a>So SRP is about having classes with just <span class="docEmphasis">a few</span><a name="relates to"></a> methods. But how few? The concept of "a few" here is rather vague and relates to the actual single responsibility. It's impossible to set a physical boundary for "a few" and say, for example, that it can never exceed 10 or 30. A class should have only the methods that logically participate in the implementation of a single purpose.</p>
<p class="docText"><a name="This said"></a>This said, it's hard to imagine an SRP-compliant class with 30 or more methods. If this is the case, well, you're probably giving a class a single responsibility—but too big of one! (A quick rule of thumb is keeping an eye on the vertical scrollbar when you edit the file in Visual Studio. Ideally, the scrolling area is kept to a minimum.)</p>
</td></tr></tbody></table><p></p><br>

<a name="mapping_behavior_to_methods"></a>
<h5 id="title-ID0E1NBG" class="docSection3Title">4.3.1.2. Mapping Behavior to Methods</h5>
<p class="docText"><a name="of the"></a>All in all, the trickiest part of the <a name="idx-CHP-4-1089"></a>design process is mapping <a name="idx-CHP-4-1090"></a><a name="it should"></a>functions to controllers. After you have established a comprehensive list of controllers, it should be clear which methods belong to each controller. A controller's methods are known as <span class="docEmphasis">action methods</span><a name="one method"></a>—and the name couldn't be more appropriate. In a controller class, you're going to have one method per user action that falls under the (single) responsibility of the controller.<a name="idx-CHP-4-1091"></a><a name="I_indexterm1_id2909072"></a></p>
<p class="docText"><a name="do you"></a>How do you code an action method? Earlier in the chapter, I identified some common steps that all action <a name="idx-CHP-4-1092"></a><a name="The template"></a>methods should implement. The template of an action method can be summarized as follows:</p>
<ul><li><p class="docList"><span class="docEmphStrong">Get input data</span><a name="idx-CHP-4-1093"></a><a name="a couple"></a> An action method can get input arguments from a couple of sources—route values and collections exposed by the <span class="docEmphasis">Request</span><a name="for action"></a> object. ASP.NET MVC doesn't mandate a particular signature for action methods. For testability reasons, it's preferable that any input parameter is received through the signature. Avoid, if you can, methods that retrieve input data programmatically from <span class="docEmphasis">Request</span><a name="passed down"></a>. Preconditions also help to ensure that no incorrect values are passed down the layers of the system.</p></li><li><p class="docList"><span class="docEmphStrong"><a name="Perform the"></a>Perform the task</span><a name="its job"></a> At this point, the method does its job based on input arguments and expected results. Most of the time, the method needs to interact with the middle tier and any interaction takes places through ad hoc dedicated services. Validation of calculated values occurs at this stage.</p></li><li><p class="docList"><span class="docEmphStrong">Fill the view model</span><a name="be incorporated"></a> At the end of the task, any (computed or referenced) values that should be incorporated in the response are added to the view model. The view model can be a plain dictionary of name/value pairs or a view-specific, strongly typed object.</p></li><li><p class="docList"><span class="docEmphStrong">Prepare the result object</span><a name="It is"></a> In ASP.NET MVC, a controller's method is not responsible for producing the response itself. It is, however, responsible for triggering the process that will use a distinct <span class="docEmphasis">View</span><a name="to render"></a> object to render content to the output stream. The method identifies the type of response (file, plain data, HTML, JavaScript, or JSON) and sets up an <span class="docEmphasis">ActionResult</span> object as appropriate.</p></li></ul>
<p class="docText"><a name="sound easy"></a>Does this sound easy overall? Well, another tricky aspect is how you devise the code that performs the task.</p>

<a name="action_methods_and_stereotypes"></a>
<h5 id="title-ID0ERQBG" class="docSection3Title">4.3.1.3. Action Methods and Stereotypes</h5>
<p class="docText"><a name="can play"></a>Generally speaking, an action method has two possible roles. It can play the role of a <span class="docEmphasis">controller</span> or it can be a <span class="docEmphasis">coordinator</span><a name="the method"></a>. For completeness, I should say that the method can also be a <span class="docEmphasis">service provider</span>; however, this won't likely happen in real-world <a name="idx-CHP-4-1094"></a>applications.</p>
<p class="docText">Where do words like <span class="docEmphasis">controller, coordinator</span>, and <span class="docEmphasis">service provider</span> come from? Needless to say, in this context the word <span class="docEmphasis">controller</span> has nothing to do with an ASP.NET MVC controller class.</p>
<p class="docText">These words refer to <span class="docEmphasis">object stereotypes</span>, a concept that comes from a methodology known as <a name="idx-CHP-4-1095"></a>Responsibility-Driven Design (<a name="idx-CHP-4-1096"></a>RDD). Normally, RDD applies to the <a name="idx-CHP-4-1097"></a><a name="apply neatly"></a>design of an object model, but some of its concepts also apply neatly to the relatively simpler problem of modeling the <a name="idx-CHP-4-1098"></a><a name="behavior of"></a>behavior of an action method.<a name="idx-CHP-4-1099"></a></p>
<a name="note-52"></a><hr size="1" noshade="noshade"><p><span class="v2"><i><b>Note:</b></i></span></p>
<p class="docText"><a name="out"></a>For more information about RDD, check out <span class="docEmphasis">Object Design: Roles, Responsibilities, and Collaborations</span>, by Rebecca Wirfs-Brock and Alan McKean (Addison-Wesley, 2002).</p>
<hr size="1" noshade="noshade">
<p class="docText">A <span class="docEmphasis">stereotype</span> refers to a set <a name="idx-CHP-4-1100"></a>of traits that characterizes the <a name="idx-CHP-4-1101"></a>behavior of an object or, as in this case, a method. <a class="docLink" href="javascript:moveTo('stereotypes_that_might_apply_to_an_actio');">Table 4-8</a> details the RDD stereotypes that might apply to an action method.</p>
<a name="stereotypes_that_might_apply_to_an_actio"></a><p></p><table cellspacing="0" border="1" width="100%"><caption><h5 class="docTableTitle">Table 4-8. Stereotypes that might apply to an action method</h5></caption><colgroup span="2"><col><col></colgroup><thead><tr><th scope="col" class="docTableCell thead">Stereotype</th><th scope="col" class="docTableCell thead">Description</th></tr></thead><tbody><tr><td class="docTableCell"><span class="docEmphasis">Controller</span></td><td class="docTableCell"><a name="and makes"></a>Refers to a behavior in which the method directs activities and makes most of the important decisions regarding its assigned task.</td></tr><tr><td class="docTableCell"><span class="docEmphasis">Coordinator</span></td><td class="docTableCell"><a name="to other"></a>Refers to a behavior in which the method delegates work to other components and is limited to orchestrating the various steps of its assigned task.</td></tr><tr><td class="docTableCell"><span class="docEmphasis">Service provider</span></td><td class="docTableCell"><a name="to a"></a>Refers to a behavior in which the method just performs a particular operation with no interaction with the outside world.
<span class="docEmphasis"><a name="realistically apply"></a>This role doesn't realistically apply to an action method because it implies an overall, one-step, simple task that doesn't require connections to other layers or tiers. It would be good for quick demos, but not for a real-world application. In RDD, a service provider is commonly a component that controllers and coordinators work with</span>.</td></tr></tbody></table><p></p><br>
<p class="docText"><a name="of a"></a>So should an action method play the role of a <span class="docEmphasis">controller</span> or <span class="docEmphasis">coordinator</span>?</p>
<p class="docText"><a name="architecture of"></a>That mostly depends on the architecture of your business layer. An ASP.NET MVC controller class belongs to the presentation layer and needs to get in touch with other layers to perform any significant task. <a class="docLink" href="javascript:moveTo('a_typical_layered_architecture_that_is_c');">Figure 4-10</a><a name="on ASP"></a> provides a graphical view of a classic layered architecture focused on ASP.NET MVC on the presentation layer.</p>
<a name="a_typical_layered_architecture_that_is_c"></a><p></p><center>
<h5 class="docFigureTitle"><a name="Figure "></a>Figure 4-10. A typical layered architecture that is common to many ASP.NET applications</h5>
<a name="I_mediaobject1_id2909502"></a>

<p class="docText">
<img border="0" id="" src="./Om Controllers og controllers og funktioner og controllers. _files/getfile(1)" alt="">
</p>

</center><p></p><br>
<p class="docText"><a name="Layer pattern"></a>If you implement the Service Layer pattern in the Business Logic Layer (BLL), your action <a name="idx-CHP-4-1102"></a><a name="method on"></a>methods simply delegate the performance of their task to a method on the service layer:</p>
<div class="codeSegmentsExpansionLinks">
                            Code View:
                            <span>Scroll</span>
                                /
                                <a href="javascript:expandCodeSegments()">Show All</a></div><pre class="preFixedWidth">[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Update(Customer customer)
{
     // The code below determines a tight relationship between the controller
     // and service layer. The service instance should be injected into the
     // controller class instead of being created.
     CustomerServiceLayer service = new CustomerServiceLayer();<a name="idx-CHP-4-1103"></a>
     service.UpdateCustomer(customer);

     // Back to the Edit view
     return View("Edit");
}

					    </pre><br>

<p class="docText">By <a name="idx-CHP-4-1104"></a>design, a service layer is made of coarse-grained <a name="idx-CHP-4-1105"></a><a name="from an"></a>methods that map to UI functions. This is to say that from an action method you can easily find a matching method to call on the service layer. In this case, your action method clearly plays the role of the <span class="docEmphasis">coordinator</span><a name="the most"></a>—which is the most desirable option from a testing and maintenance perspective.</p>
<p class="docText"><a name="implement the"></a>If you implement the <a name="idx-CHP-4-1106"></a><a name="persistence interface"></a>Repository pattern, or if you just expose the native persistence interface (for example, Entity Framework's <span class="docEmphasis">ObjectContext</span><a name="action method"></a> object), you end up with an action method that plays the role of the <span class="docEmphasis">controller</span><a name="code snippet"></a>. It incorporates all the logic necessary to perform the task. Here's a code snippet if you have direct access to the persistence layer:</p>
<pre>[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Update(Customer customer)
{
     // Get the entity model handle
     MyAppEntities context = new MyAppEntities();

     // Apply changes
     // This pseudo-syntax is based on features in Entity Framework 4
     context.Customers.ApplyChanges(customer, ...);

     // Save to storage
     context.SaveChanges();

     // Back to the Edit view
     return View("Edit");
}</pre><br>

<p class="docText"><a name="A solution"></a>A solution in which the action method gains direct access to the persistence layer results in intrinsically more coupled code that can get even worse as the complexity grows. You clearly see that, in this case, the action method is directing activities and making any decisions required for the task to perform its duties.</p>
<p class="docText"><a name="an update"></a>Let's consider the Repository pattern using an update scenario. If you have implemented the Repository pattern, your update action code will look like this:</p>
<div class="codeSegmentsExpansionLinks">
                            Code View:
                            <span>Scroll</span>
                                /
                                <a href="javascript:expandCodeSegments()">Show All</a></div><pre class="preFixedWidth">[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Update(Customer customer)
{
     // Tight coupling between controller class and repositories. The
     // instance of the repository should ideally be injected into the controller.
     CustomerRepository rep = new CustomerRepository();
     rep.UpdateCustomer(customer);

     // Back to the Edit view
     return View("Edit");
}

					    </pre><br>

<p class="docText"><a name="Why is"></a>So what's the difference between this approach and the Service Layer pattern? Why is it that using a <a name="idx-CHP-4-1107"></a>repository configures a <span class="docEmphasis">controller</span> role, whereas using the service layer upgrades the <a name="idx-CHP-4-1108"></a>action method <a name="idx-CHP-4-1109"></a>to the rank <a name="idx-CHP-4-1110"></a>of a <span class="docEmphasis">coordinator</span>? Is a coordinator role always preferable?</p>

<a name="action_methods_coordinator_vs_controller"></a>
<h5 id="title-ID0EPZBG" class="docSection3Title">4.3.1.4. Action Methods: Coordinator vs. Controller</h5>
<p class="docText"><a name="a controller"></a>Admittedly, you might not see the difference between a coordinator and a controller from the preceding trivial code. It's exactly the complexity of the code, however, that constitutes the difference. A service layer refers to a much higher level of abstraction than a plain repository. As mentioned earlier, the service layer belongs to the BLL, whereas the repository is part of the DAL. The repository encapsulates only data access operations; the service layer encapsulates all operations in the use-case being implemented.<a name="idx-CHP-4-1111"></a><a name="idx-CHP-4-1112"></a></p>
<p class="docText"><a name="a more"></a>In a more complex scenario, the performance of a UI-invoked task likely spans multiple entities and repositories and requires multiple database operations. If this is the case, you end up filling the action method with multiple calls to repositories and perhaps internal BLL components. The overall code then slowly leads the action method into a controller role.</p>
<p class="docText"><a name="end there"></a>But it doesn't end there. Giving an action method the role of the coordinator gets you a couple of nontrivial benefits.</p>
<p class="docText"><a name="because you"></a>First, testing the controller in isolation is much easier because you have to mock up only one dependency—the service layer class—which is a class of yours. If the controller depends on, say, Entity Framework, you will have a much harder time testing in isolation.</p>
<p class="docText">Second, think about <a name="idx-CHP-4-1113"></a>deployment and <a name="idx-CHP-4-1114"></a><a name="Web server"></a>scalability. The controller lives on the Web server within the boundaries of the ASP.NET worker process. What about the DAL? Ideally, the DAL lives on the same machine as the database. If you have a distinct database server, either you end up placing a bunch of remote database calls (when the DAL is in the same tier as controllers) or, worse, you place a number of cross-tier calls to the DAL (when the DAL is on the database server). With a service layer, you make just one cross-tier call from the presentation per action. In addition, you have an extra layer to scale out if you have scalability issues.<a name="I_indexterm1_id2909799"></a></p>
<a name="note-53"></a><hr size="1" noshade="noshade"><p><span class="v2"><i><b>Note:</b></i></span></p>
<p class="docText"><a name="the DAL"></a>If you're considering the use of a simpler Repository layer in the DAL and then decide to place it on a tier distinct from controllers, you have the problem of remoting the Repository interface. In practice, this means creating a Windows Communication Foundation (WCF) service around your repository classes. At this point, you probably want to make the WCF service interface a bit chunky to avoid the RPC-like communication antipattern. In doing so, you simply move from a Repository pattern to a Service Layer pattern. Think of it in advance then!</p>
<hr size="1" noshade="noshade">
<a name="design_is_design_regardless_of_whether_o"></a><p></p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tbody><tr><td>
<h2 class="docSidebarTitle"><a name="Design Is"></a>Design Is Design, Regardless of Whether or Not It's for the Web</h2>
<p class="docText"><a name="down the"></a>Although ASP.NET MVC gently leads you down the right path for software design, it doesn't really have the superhuman power of stopping you from screwing things up. Even in the strongly object-oriented world of ASP.NET MVC, you can end up <a name="idx-CHP-4-1115"></a>writing bad code.</p>
<p class="docText"><a name="Forms and"></a>As I see things, one of the biggest differences between Web Forms and ASP.NET MVC from the developer's standpoint is that ASP.NET MVC requires you to possess some design skills before you can effectively start and to have a clear architectural vision of what you're building. Put another way, ASP.NET MVC is not as forgiving as Web Forms can be and makes learning as you go significantly harder. Trial and error can really be a dangerous approach in ASP.NET MVC.</p>
<p class="docText"><a name="same thing"></a>Want practical advice? Don't mistake ASP.NET MVC views and Web Forms pages. They're actually the same thing as far as display is concerned. However, they are radically different entities as far as design is concerned. When you design a Web Forms application, you focus on pages and you map functionalities to pages. In ASP.NET MVC, you should focus on functions instead and map them to controllers and methods. A view in ASP.NET MVC, therefore, is simply a piece of the infrastructure that merges a template for the page with some input data. No code at all belongs to the view.</p>
<p class="docText"><a name="complete the"></a>To complete the parallel, in Web Forms a page mixes a template with code and the code is responsible for generating data and for mapping data to elements in the template. It is a much more entangled graph of relationships that forms a (perfectly working) black box.</p>
<p class="docText"><a name="you approach"></a>The way you approach the <a name="idx-CHP-4-1116"></a><a name="requires preparation"></a>design of functionalities in ASP.NET MVC is different and requires preparation, skills, and possibly an unbiased mind. If you are still stuck finding the best way to render a "page" as a "view," the best thing you can do is add a plain Web Forms page to an ASP.NET MVC application.</p>
<p class="docText"><a name="MVC is"></a>The right way to approach ASP.NET MVC is by the classic rules of analysis and design. You identify the functions that need to be implemented and find the right component that can take care of that. This component will return some output values to you. You pass these values to a component that will merge them into a template to produce HTML. In ASP.NET MVC, design is plain design; it's not different from the design of a Windows or Windows Presentation Foundation (WPF) application or a service. Gone are the days when a Web application has to be devised (if not implemented) using a made-to-measure set of principles and design guidelines.</p>
</td></tr></tbody></table><p></p><br>


<a name="should_you_use_your_own_base_class"></a>
<h4 id="title-ID0EF3BG" class="docSection2Title">4.3.2. Should You Use Your Own Base Class?</h4>
<p class="docText">An aspect you might want to seriously consider when <a name="idx-CHP-4-1117"></a><a name="common functionality"></a>writing a controller class is adding an extra layer of common functionality in an intermediate controller class. You define your application-specific base controller class and inherit your working controllers from there. In this way, you can have available in all of your working controllers an additional set of properties.</p>
<p class="docText"><a name="The question"></a>The question mark in the title of the section suggests that there might be situations in which an application-specific base controller class is not required. Frankly, I believe you should always have your own base class for any application of some complexity.</p>
<p class="docText"><a name="The number"></a>How should you measure complexity here? The number of requirements? The frequency of requirements changes? Complexity is a nebulous concept and, overall, something that is hard to describe but easy to recognize when you see it.</p>
<p class="docText"><a name="having quite"></a>As far as ASP.NET MVC is concerned, I'd say that when you start having quite a few controllers, you might find it useful and more productive to move some common functionalities out to a <a name="idx-CHP-4-1118"></a>superclass.</p>
<a name="signature_of_a_controller_superclass"></a>
<h5 id="title-ID0EB4BG" class="docSection3Title">4.3.2.1. Signature of a Controller SuperClass</h5>
<p class="docText"><a name="will inherit"></a>A firm point about the new superclass is that it will inherit from <span class="docEmphasis">Controller</span><a name="following class"></a>. The following class definition doesn't really move any code around, but it creates an extra layer that adds flexibility to the whole solution:<a name="idx-CHP-4-1119"></a></p>
<pre>public class MyControllerSuperClass : Controller
{
}</pre><br>

<p class="docText"><a name="question is"></a>The next question is also the most critical—what kind of functions would you add to the superclass?</p>
<p class="docText">The <span class="docEmphasis">MyControllerSuperClass</span><a name="overriding some"></a> class creates a safe and clean environment for overriding some of the <span class="docEmphasis">Controller</span><a name="methods and"></a> virtual methods without mixing action methods and internal features. For example, you can override the <span class="docEmphasis">ExecuteCore</span> method of <span class="docEmphasis">Controller</span> to add logging capabilities:</p>
<div class="codeSegmentsExpansionLinks">
                            Code View:
                            <span>Scroll</span>
                                /
                                <a href="javascript:expandCodeSegments()">Show All</a></div><pre class="preFixedHeight">public class MyControllerSuperClass : Controller
{
    // We should make the setter internal and provide for it during the construction
    // of the controller. However, this is not possible unless we set up a custom
    // controller factory. We'll see how to do that in Chapter 11.
    public ILogger Logger { get; set; }

    protected override void ExecuteCore()
    {
        // Capture the name of the action being executed.
        string action = this.RouteData.GetRequiredString("action");
        // Log before executing
        if (<a name="idx-CHP-4-1120"></a>Logger != null)
        {
            Logger.Log("Executing [{0}] action at {1}",
                           action, DateTime.Now.ToString());
        }
        // Execute as usual
        base.ExecuteCore();

        // Log after execution
        if (Logger != null)
        {
            Logger.Log("Executed [{0}] action at {1}",
                            action, DateTime.Now.ToString());
        }
   }
}

					    </pre><br>

<p class="docText">The <span class="docEmphasis">MyControllerSuperClass</span> superclass now features an additional member—<span class="docEmphasis">Logger</span> of a custom type <span class="docEmphasis">ILogger</span>:<a name="idx-CHP-4-1121"></a><a name="idx-CHP-4-1122"></a></p>
<pre>public interface ILogger
{
    void Log(string format, params object[] args);
}</pre><br>

<p class="docText"><span class="docEmphasis">MyControllerSuperClass</span> now has a dependency on the <span class="docEmphasis">ILogger</span><a name="if"></a> type, which is a good thing. It would have been much worse if <span class="docEmphasis">MyControllerSuperClass</span><a name="retained a"></a> retained a dependency on an actual implementation of <span class="docEmphasis">ILogger</span>. In the preceding code, <span class="docEmphasis">MyControllerSuperClass</span> injected a member of type <span class="docEmphasis">ILogger</span><a name="a great"></a> as an external dependency. This is a great achievement for testability.</p>
<p class="docText">The preceding code doesn't show how the <span class="docEmphasis">Logger</span> property initialized and when. I briefly hinted at dependency <a name="idx-CHP-4-1123"></a>injection, but <a name="idx-CHP-4-1124"></a><a name="at which"></a>dependency injection is the means. It doesn't say much about the time at which injection can occur. I'll get back to this point in a moment. Let's see a couple of other features you can easily stuff in a <a name="idx-CHP-4-1125"></a><a name="unknown actions"></a>controller superclass, such as exception handling and your own policy for unknown actions.</p>
<a name="note-54"></a><hr size="1" noshade="noshade"><p><span class="v2"><i><b>Note:</b></i></span></p>
<p class="docText"><a name="injection "></a>Dependency injection (DI) is simply a pattern according to which a class exposes <a name="idx-CHP-4-1126"></a><a name="for external"></a>injection points for external callers to pass it references to specific objects. Common injection points are the constructor of the class, a public property, or perhaps the <a name="idx-CHP-4-1127"></a><a name="is all"></a>signature of a method. This is what dependency injection is all about. It turns out that any code required to retrieve and instantiate external objects pertains to the caller. And it is fairly repetitive code. This is where Inversion of Control (IoC) frameworks kick in. They essentially automate the implementation of the DI pattern. We could even say that IoC frameworks are an idiom of DI.<a name="I_indexterm1_id2910214"></a></p>
<p class="docText"><a name="out already"></a>As you might have figured out already, some really powerful code results from the integration of an IoC framework and a controller superclass.</p>
<hr size="1" noshade="noshade">

<a name="centralized_exception_handling"></a>
<h5 id="title-ID0EBBAI" class="docSection3Title">4.3.2.2. Centralized Exception Handling</h5>
<p class="docText">The aforementioned <span class="docEmphasis">HandleError</span><a name="or all"></a> attribute enables centralized exception handling for a single action method or all methods in a controller. Filter attributes are inheritable, so if you add <span class="docEmphasis">HandleError</span><a name="to the"></a> to the superclass, all derived controllers automatically gain the ability to trap exceptions:<a name="idx-CHP-4-1128"></a></p>
<pre>[HandleError]
public class MyControllerSuperClass : Controller
{
   ⋮
}</pre><br>

<p class="docText"><a name="from adding"></a>The preceding code doesn't prevent you from adding a more specific version of the <span class="docEmphasis">HandleError</span><a name="and redirect"></a> attribute in your actual controllers to trap a particular exception and redirect to an ad hoc view.</p>
<p class="docText">In addition, you can still override the <span class="docEmphasis">OnException</span> method in the <span class="docEmphasis">MyControllerSuperClass</span> class to set up your own exception-handling mechanism:</p>
<pre>protected override void OnException(ExceptionContext filterContext)
{
    // Your exception handling logic here
    ⋮
}</pre><br>

<p class="docText">The <span class="docEmphasis">OnException</span><a name="occurs in"></a> method is guaranteed to be invoked whenever an unhandled exception occurs in the execution of the action.</p>

<a name="handling_unknown_actions"></a>
<h5 id="title-ID0ENCAI" class="docSection3Title">4.3.2.3. Handling Unknown Actions</h5>
<p class="docText"><a name="controller superclass"></a>The controller superclass is also an excellent place to store any common logic you want to employ to handle the invocation of an unknown action. All you do is override the method <span class="docEmphasis">HandleUnknownAction</span>, as shown here:<a name="idx-CHP-4-1129"></a></p>
<pre>protected override void HandleUnknownAction(string actionName)
{
    // Your logic here to handle unknown actions
    ⋮
}</pre><br>

<p class="docText"><a name="for unknown"></a>The logic for unknown actions is good to have to avoid nasty HTTP 404 failures and possibly a generic error view. Specifying the wrong action is logically a different error than HTTP 404. For this reason, you might want to employ your own logic and display a nice error message to the user while making it clear to search engines that the requested URL is not valid. Furthermore, you don't want to reiterate the same fairly vanilla logic over and over again for each controller you write. A superclass comes to the rescue, as shown here:</p>
<pre>protected override void <a name="idx-CHP-4-1130"></a>HandleUnknownAction(string actionName)
{
    // Your logic here to handle <a name="idx-CHP-4-1131"></a>unknown actions
    ⋮

    // Fill in the view model
    string format = "Action &lt;b&gt;[{0}].[{1}]&lt;/b&gt; is not supported.";
    this.ViewData["Message"] = String.Format(format,
             this.ControllerMoniker, actionName);

    // Set the status code for search engines
    this.Response.StatusCode = 404;

    // Switch to a nice user-specific view from here
    this.View("CustomError").ExecuteResult(this.ControllerContext);
}</pre><br>

<p class="docText"><a name="performed any"></a>After you have caught the unknown action and performed any related tasks (for example, logging), you are ready to display a message to the user. Typically, you want to show both controller and action name in the message. The action name can be obtained from the argument list; the controller name must be obtained programmatically. The new <span class="docEmphasis">MyControllerSuperClass.ControllerMoniker</span><a name="the controller"></a> property does that by reading the controller name from the route data:</p>
<div class="codeSegmentsExpansionLinks">
                            Code View:
                            <span>Scroll</span>
                                /
                                <a href="javascript:expandCodeSegments()">Show All</a></div><pre class="preFixedWidth">private string _controllerMoniker = String.Empty;
public string ControllerMoniker
{
    get
    {
        if (String.IsNullOrEmpty(_controllerMoniker))
            _controllerMoniker = this.RouteData.GetRequiredString("controller");
        return _controllerMoniker;
    }
}

					    </pre><br>

<p class="docText"><a name="the simplest"></a>To inform the user that an unknown command has been sent, the simplest thing to do is invoke the <span class="docEmphasis">View</span><a name="method on"></a> method on the controller class to get a <span class="docEmphasis">ViewResult</span> object. Next, you call <span class="docEmphasis">ExecuteResult</span> to render the view:</p>
<pre>this.View("CustomError").ExecuteResult(this.ControllerContext);</pre><br>

<p class="docText"><a name="the"></a>Here's some sample code that shows the <span class="docEmphasis">CustomError</span> view. (I'll cover views in the next chapter.)</p>
<pre>&lt;h2&gt;
&lt;%
    string msg = "Sorry, an error occurred while processing your request.";
    if (this.ViewData.ContainsKey("Message"))
        msg = this.ViewData["Message"] as string;
%&gt;
&lt;% = msg %&gt;
&lt;/h2&gt;</pre><br>

<p class="docText"><a class="docLink" href="javascript:moveTo('handling_an_unknown_action');">Figure 4-11</a> shows the effect of having a handler for <a name="idx-CHP-4-1132"></a>unknown actions.</p>
<a name="handling_an_unknown_action"></a><p></p><center>
<h5 class="docFigureTitle">Figure 4-11. Handling an unknown action</h5>
<a name="I_mediaobject1_id2910465"></a>

<p class="docText">
<img border="0" id="" src="./Om Controllers og controllers og funktioner og controllers. _files/getfile(2)" alt="">
</p>

</center><p></p><br>
<p class="docText"><a name="action or"></a>Displaying a view is more effective than redirecting to an action or to an error page. In the example, the HTML view based on the <span class="docEmphasis">CustomError</span><a name="work and"></a> template is just the response to invoking an unknown action—no extra work and no extra roundtrips.</p>

<a name="managing_dependencies"></a>
<h5 id="title-ID0EUFAI" class="docSection3Title">4.3.2.4. Managing Dependencies</h5>
<p class="docText"><a name="a controller"></a>In ASP.NET MVC, a controller class is not simply a class with a bunch of public methods. It is responsible, for example, for connecting to a number of external components, not the least of which is the gateway to the middle tier. In addition, the controller is responsible for supporting a number of cross-cutting concerns (for example, logging, security, localized information to pass on to the view, or caching).<a name="idx-CHP-4-1133"></a><a name="I_indexterm1_id2910533"></a></p>
<p class="docText"><a name="these concerns"></a>Each of these concerns might require an external dependency—that is, an object that must either be instantiated by the controller or created outside the controller and passed to it. A controller superclass is perfect for providing this infrastructure.</p>
<p class="docText"><a name="define an"></a>A way to approach the task is to define an application-wide context class that groups all <a name="idx-CHP-4-1134"></a>dependencies shared by all controllers. Here's an example:</p>
<div class="codeSegmentsExpansionLinks">
                            Code View:
                            <span>Scroll</span>
                                /
                                <a href="javascript:expandCodeSegments()">Show All</a></div><pre class="preFixedHeight">public class <a name="idx-CHP-4-1135"></a>ApplicationContext
{
    // Constructors
    public ApplicationContext()
    {
        <a name="idx-CHP-4-1136"></a>Initialize(null, null);
    }
    public ApplicationContext(ServiceLayerContext context)
    {
        Initialize(context, null);
    }
    public ApplicationContext(ServiceLayerContext context, ILogger logger)
    {
        Initialize(context, logger);
    }

    // Properties
    public ServiceLayerContext ServiceLayerContext { get; private set; }
    public ILogger Logger { get; private set; }

    // Methods
    private void Initialize(ServiceLayerContext context, ILogger logger)
    {
       ⋮
    }
}

					    </pre><br>

<p class="docText">In <span class="docEmphasis">ApplicationContext</span><a name="to be"></a>, you group objects that need to be instantiated and then injected in the controller for execution and testing purposes. You won't place properties (or methods) here, such as <span class="docEmphasis">ControllerMoniker</span><a name="internal context"></a>, that are resolved in terms of the members of the internal context of the controller itself.<a name="idx-CHP-4-1137"></a></p>
<p class="docText"><a name="The method"></a>The method <span class="docEmphasis">Initialize</span><a name="dependencies for"></a> is responsible for resolving any dependencies for which an explicit value is not provided as an argument:</p>
<div class="codeSegmentsExpansionLinks">
                            Code View:
                            <span>Scroll</span>
                                /
                                <a href="javascript:expandCodeSegments()">Show All</a></div><pre class="preFixedWidth">private void Initialize(ServiceLayerContext context, ILogger logger)
{
    // Ensures that ServiceLayerContext member and its child members are instantiated
    this.ServiceLayerContext = (context ?? new ServiceLayerContext());
    if (this.ServiceLayerContext.ContentServiceLayer == null)
        this.ServiceLayerContext.ContentServiceLayer = new ContentServices();

    // Repeat for any members in the service layer context
    ⋮
    // Ensures that Logger is instantiated
    this.Logger = (logger ?? new FileLogger(...));
}

					    </pre><br>

<p class="docText">Let's skip over the details of the <span class="docEmphasis">ServiceLayerContext</span><a name="represents the"></a> class for a moment. For now, suffice it to say that it represents the gateway to the middle tier.</p>
<p class="docText">At this point, you have a unique object that groups all <a name="idx-CHP-4-1138"></a><a name="object down"></a>dependencies required by a nontrivial controller. How would you pass this object down to the controller? Here's some code:</p>
<div class="codeSegmentsExpansionLinks">
                            Code View:
                            <span>Scroll</span>
                                /
                                <a href="javascript:expandCodeSegments()">Show All</a></div><pre class="preFixedHeight">public class MyControllerSuperClass : Controller
{
    public MyControllerSuperClass() : base()
    {
    }
    public MyControllerSuperClass(<a name="idx-CHP-4-1139"></a>ApplicationContext appContext) :
    this()
    {
        _appContext = (appContext ?? new ApplicationContext());
    }

    // Fields
    private ApplicationContext _appContext = null;
    ⋮

    // Properties
    public ApplicationContext ApplicationContext
    {
        get
        {
            if (_appContext == null)
                _appContext = new ApplicationContext();
            return _appContext;
        }
        set
        {
            _appContext = value;
        }
    }

    ⋮

}

					    </pre><br>

<p class="docText"><a name="best deal"></a>The best deal is if you can provide a double constructor—the default parameterless constructor plus one that receives an <span class="docEmphasis">ApplicationContext</span><a name="an argument"></a> object as an argument. The ASP.NET MVC framework will use the default constructor to create instances of any derived class.</p>
<p class="docText"><a name="a unit"></a>The second constructor is provided for testability reasons. In a unit test, in fact, you might want to inject an instance of <span class="docEmphasis">ApplicationContext</span><a name="ad hoc"></a> that points to fake objects. An ad hoc constructor greatly simplifies this task.</p>
<p class="docText"><a name="code path"></a>When the default constructor is used, however, you need to provide a built-in code path that instantiates <span class="docEmphasis">ApplicationContext</span><a name="The"></a>. The <span class="docEmphasis">getter</span><a name="to be"></a> method of the property seems to be the ideal place.<a name="idx-CHP-4-1140"></a></p>

<a name="the_controllers_factory"></a>
<h5 id="title-ID0EDJAI" class="docSection3Title">4.3.2.5. The Controller's Factory</h5>
<p class="docText"><a name="takes place"></a>The instantiation of a controller class is an operation that takes place outside the reach of your code. A made-to-measure factory class takes care of that. The ASP.NET MVC framework provides such a class in the form of <span class="docEmphasis">DefaultControllerFactory</span>.<a name="idx-CHP-4-1141"></a></p>
<p class="docText">The <span class="docEmphasis">DefaultControllerFactory</span><a name="it doesn"></a> class defaults to using the parameterless constructor and fails if it doesn't exist. If you want to change something in the process of creating a controller instance, you have no other choice than to write and register your own controller factory. I'll discuss this in greater detail in <a class="docLink" onclick="if (window.goTo) { window.goTo(&#39;9780735645295/customizing_asp_net_mvc&#39;,&#39;&#39;); return false; }" href="http://proquest.safaribooksonline.com/9780735645295/customizing_asp_net_mvc#customizing_asp_net_mvc">Chapter 11</a><a name="is dedicated"></a>, which is dedicated to customizing the various pieces of the ASP.NET MVC puzzle.<a name="idx-CHP-4-1142"></a></p>
<p class="docText"><a name="feature you"></a>A nice feature you can easily implement in the factory (and exactly the feature I'll be demonstrating in <a class="docLink" onclick="if (window.goTo) { window.goTo(&#39;9780735645295/customizing_asp_net_mvc&#39;,&#39;&#39;); return false; }" href="http://proquest.safaribooksonline.com/9780735645295/customizing_asp_net_mvc#customizing_asp_net_mvc">Chapter 11</a><a name="resolve automatically"></a>) is the use of an IoC container to resolve automatically all <a name="idx-CHP-4-1143"></a><a name="in which"></a>dependencies at the same time in which a new instance of the controller is created.</p>
<a name="note-55"></a><hr size="1" noshade="noshade"><p><span class="v2"><i><b>Note:</b></i></span></p>
<p class="docText"><a name="made of"></a>In ASP.NET MVC, it's mandatory that the name of the controller class is made of two tokens—a moniker and the suffix <span class="docEmphasis">Controller</span><a name="For example"></a>. For example, valid names for classes are <span class="docEmphasis">HomeController, CustomerController, MenuController</span><a name="requires you"></a>, and the like. However, when a method requires you to specify a controller name (for example, one of the overloads to the <span class="docEmphasis">Controller</span>'s <span class="docEmphasis">RedirectToAction</span> method), you should indicate only the moniker without the <span class="docEmphasis">Controller</span><a name="the controller"></a> suffix. If you fail to do so, ASP.NET MVC won't be able to recognize the controller class and an exception will be thrown.</p>
<p class="docText"><a name="is matched"></a>There's just one place in the full framework where the moniker is matched to an actual controller type—in the factory class and, specifically, in the <span class="docEmphasis">GetControllerType</span><a name="overriding that"></a> method. By overriding that method, you can circumvent the default convention of having a trailing "<span class="docEmphasis">Controller</span><a name="every controller"></a>" string in every controller class name. However, I'm not saying that you have to break the convention; nonetheless, the extreme flexibility of the ASP.NET MVC framework also makes that possible.</p>
<hr size="1" noshade="noshade">



<input value="9780735645295/writing_a_controller" type="hidden" name="" id="Reader_CurrentXmlId"><input value="9780735645295/anatomy_of_an_aspnet_mvc_controller" type="hidden" name="" id="Reader_PreviousXmlId"><input value="9780735645295/special_capabilities" type="hidden" name="" id="Reader_NextXmlId"><input value="" type="hidden" name="" id="Reader_IndexPage"></div></div></div><script language="javascript" type="text/javascript"><!--
var b={'containerid':'readercontent','viewerid':'HtmlView','xmlid':'9780735645295/writing_a_controller','allowbookmarks':false,'allownotes':false,'508enabled':false,'printheader':'','printfooter':'','previewmessage':'','debugmode':false,'showsoms':false,'accesskey':'','somstate':'','zoom':'120'};W.CC.CD(b,'html');//--></script></div><div class="toolbar" id="readertoolbar2"><span class="rightcap"></span><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'topbuttons2','Url':'/_ajax_flashreader','MergeName':'FlashReader','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':null,'IsXml':false,'StaticOnLoad':true,'DisableAjaxHistory':false,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=flashreader','reader=html','__isrc='),'DynamicParameters':new Array('xmlid=9780735645295%2fwriting_a_controller','imagepage=')});//--></script><div id="topbuttons2" style="display: block; "><div class="fltlft"><ul class="toolbar_btn_list"><li id="toolbar_logo2"><img alt="Safari Books Online" title="Safari Books Online" src="./Om Controllers og controllers og funktioner og controllers. _files/logo_toolbar_full.gif"></li><li class="w24"><a class="remail" id="email2" href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="return W.f.Co(this,&#39;http://proquest.safaribooksonline.com/9780735645295/writing_a_controller&#39;);" title="Email This Page (Key: e)">Email This Page (Key: e)</a><span class="emailDisabled">Email This Page</span></li><li class="w24"><a class="print" id="print2" href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="Cc.Cp();return false;" title="Print">Print</a><span class="printDisabled">Print</span></li></ul></div></div><div class="fltrght"><ul class="toolbar_btn_list"><li class="w68"><a class="html active" id="html2" href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/writing_a_controller?reader=" title="Html View (Key: h)">Html View (Key: h)</a></li><li class="w27a" id="zoomOutBtns2"><a class="fontdn" id="fontdn2" href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="Cc.Cr();return false;" title="Zoom Out (Key: -)">Zoom Out (Key: -)</a><span class="fontdnDisabled">Zoom Out</span></li><li class="w27" id="zoomInBtns2"><a class="fontup" id="fontup2" href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="Cc.Cs();return false;" title="Zoom In (Key: +)">Zoom In (Key: +)</a><span class="fontupDisabled">Zoom In</span></li><li class="screen"><a class="fullscreen " id="fullscreenbtn2" href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="W.CC.Cv();return false;" title="Toggle to Full Screen (Key: f)">Toggle to Full Screen (Key: f)</a></li><li class="w24 " id="prevBtns2"><a class="prev" id="prev2" href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/anatomy_of_an_aspnet_mvc_controller" accesskey="1" onclick="W.CC.Cw();return false;" title="Previous (Key: p)">Previous (Key: p)</a><span class="prevDisabled">Previous</span></li><li class="w24 " id="nextBtns2"><a class="next" id="next2" href="http://proquest.safaribooksonline.com/programming/microsoft-aspdotnet/9780735645295/inside-controllers/special_capabilities" accesskey="3" onclick="W.CC.Cx();return false;" title="Next (Key: n)">Next (Key: n)</a><span class="nextDisabled">Next</span></li></ul></div></div><script language="javascript" type="text/javascript"><!--
if(!window.ajaxComponents)window.ajaxComponents=new Array();window.ajaxComponents.push({'Id':'SomsView','Url':'/_ajax_htmlview','MergeName':'HtmlView','ReadyFunction':null,'Priority':0,'ShowLoading':false,'AfterReadyFunction':null,'IsXml':false,'StaticOnLoad':false,'DisableAjaxHistory':true,'Cacheable':false,'Updates':new Array(),'StaticParameters':new Array('__className=bookhtmlcontent','reader=html'),'DynamicParameters':new Array('query=(SQL%2fXML)')});//--></script><div id="SomsView" style="display: none; "></div><div style="display:none;"><div id="offlinepopupid"><div class="overlayBox1"><div class="olay1ct hand" onmousedown="T.k.l(event,this);"><a href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="T.m.n(this);return false;" title="Close Window"><img class="x3" alt="Close Window" title="Close Window" id="layerclosebutton" src="./Om Controllers og controllers og funktioner og controllers. _files/btn_close_x_orange.gif"></a><div class="olay1cl"></div></div><div class="pupBox1int"><div class="popupContent"><div><h5 class="h5 popupheader">Offline Mode</h5><div class="hdrbox1"><div class="hdr1ct"><div class="hdr1cl"></div></div><div class="hdrbox1Content offlinemsg"><p class="p">It appears that you are no longer connected to the Internet. Would you like to switch to Offline Mode?</p><p class="p">In Offline Mode you will be able to read any books that you have synced offline in your Offline Bookbag folder.</p></div><div class="hdr1bl"><div class="hdr1br"></div></div></div><div class="fltrght"><a href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="T.m.n(this);return false;" title="Close"><img alt="Close" title="Close" src="./Om Controllers og controllers og funktioner og controllers. _files/btn_close_blue.gif"></a><span> </span><img alt="Go to Offline Mode" title="Go to Offline Mode" src="./Om Controllers og controllers og funktioner og controllers. _files/btn_gooffline.gif"></div></div></div></div><div class="olay1bl"><div class="olay1br"></div></div></div><span class="clearfloats"></span></div><div id="onlinepopupid"><div class="overlayBox1"><div class="olay1ct hand" onmousedown="T.k.l(event,this);"><a href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="T.m.n(this);return false;" title="Close Window"><img class="x3" alt="Close Window" title="Close Window" id="layerclosebutton" src="./Om Controllers og controllers og funktioner og controllers. _files/btn_close_x_orange.gif"></a><div class="olay1cl"></div></div><div class="pupBox1int"><div class="popupContent"><div><h5 class="h5 popupheader">Online Mode</h5><div class="hdrbox1"><div class="hdr1ct"><div class="hdr1cl"></div></div><div class="hdrbox1Content offlinemsg"><p class="p">It appears that you are now connected to the Internet. Would you like to switch to Online Mode?</p></div><div class="hdr1bl"><div class="hdr1br"></div></div></div><div class="fltrght"><a href="http://proquest.safaribooksonline.com/9780735645295/writing_a_controller?readerfullscreen=&readerleftmenu=1&reader=html&imagepage=#" onclick="T.m.n(this);return false;" title="Close"><img alt="Close" title="Close" src="./Om Controllers og controllers og funktioner og controllers. _files/btn_close_blue.gif"></a><span> </span><img alt="Go to Online Mode" title="Go to Online Mode" src="./Om Controllers og controllers og funktioner og controllers. _files/btn_goonline.gif"></div></div></div></div><div class="olay1bl"><div class="olay1br"></div></div></div><span class="clearfloats"></span></div></div></div></div></div><div id="bvdfooter100"></div></div><script language="javascript" type="text/javascript"><!--
if(!window.noInitAjax&&self.h){h();};window.ajaxInitializationStarted=true;//--></script><script language="javascript" type="text/javascript"><!--
if(window.ajaxComponents){i.Init(window.ajaxComponents);}//--></script><script language="javascript" type="text/javascript">if (window.logHit) window.logHit();</script><script language="javascript" type="text/javascript">if (self.onPageLoad) self.onPageLoad(); if (self.customOnPageLoad) self.customOnPageLoad();</script><div id="ssdd" class="globalnav_dd_boxSS" style="text-align: left; z-index: 20000; display: none; position: absolute; "><div class="globalnav_dd_box_int1"><div class="globalnav_dd_box_intQL"><div id="ssdd_inner"></div><div class="bluBrdrBox1"><div class="blubr1ct"><div class="blubr1cl"></div></div><div class="blubrBoxContent legend"><p class="p nobotpad"><span>Title=</span><strong class="strong">Bold</strong><span>&nbsp;&nbsp;&nbsp;&nbsp;Reference Entry=</span><em class="em">Italic</em></p></div><div class="blubr1bl"><div class="blubr1br"></div></div></div></div></div></div><script language="javascript" type="text/javascript"><!--
window.pageLoadingFinished=true;//--></script><div style="display: none; " id="hiddenlpsubmitdiv"></div><script>try{for(var lastpass_iter=0; lastpass_iter < document.forms.length; lastpass_iter++){ var lastpass_f = document.forms[lastpass_iter]; if(typeof(lastpass_f.lpsubmitorig2)=="undefined"){ lastpass_f.lpsubmitorig2 = lastpass_f.submit; lastpass_f.submit = function(){ var form=this; var customEvent = document.createEvent("Event"); customEvent.initEvent("lpCustomEvent", true, true); var d = document.getElementById("hiddenlpsubmitdiv"); for(var i = 0; i < document.forms.length; i++){ if(document.forms[i]==form){ d.innerText=i; } } d.dispatchEvent(customEvent); form.lpsubmitorig2(); } } }}catch(e){}</script><div style="position: absolute; z-index: 5000; left: 0px; top: 0px; background-color: white; opacity: 0; width: 1037px; height: 12495px; display: none; "></div><div style="position: absolute; z-index: 5050; left: 518.5px; top: 425px; display: none; "><img src="./Om Controllers og controllers og funktioner og controllers. _files/layerloader.gif"></div></body></html>